<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Business Feasibility Analyzer</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<h2>Business Feasibility Analyzer</h2>

<form method="POST">
  <label for="location">Location (lat,lng):</label>
  <input type="text" name="location" id="location" placeholder="28.6139,77.2090" required>

  <label for="business">Business Type:</label>
  <select name="business" id="business">
    <option value="restaurant">Restaurant</option>
    <option value="cafe">Cafe</option>
    <option value="gym">Gym/Fitness Center</option>
    <option value="pharmacy">Pharmacy</option>
    <option value="grocery_or_supermarket">Grocery Store</option>
    <option value="bar">Bar</option>
    <option value="shopping_mall">Shopping Mall</option>
    <option value="lodging">Hotel/Inn</option>
    <option value="retail_store">Retail Store</option>
    <option value="beauty_salon">Beauty Salon</option>
    <option value="clinic">Medical Clinic</option>
    <option value="bank">Bank/Financial Services</option>
  </select>

  <label for="budget">Budget (in INR Lakhs):</label>
  <input type="number" name="budget" id="budget" placeholder="5" min="1" step="0.5" required>

  <label for="extra_notes">Additional Notes (optional):</label>
  <textarea name="extra_notes" id="extra_notes" placeholder="Any specific requirements, target audience, or special considerations..." rows="3"></textarea>

  <button type="submit">Analyze</button>
</form>

{% if result and not result.error %}
<div class="pdf-download">
  <form method="POST" action="/download_pdf" style="display: inline;">
    <input type="hidden" name="location" value="{{ request.form.get('location', '') }}">
    <input type="hidden" name="business" value="{{ request.form.get('business', '') }}">
    <input type="hidden" name="budget" value="{{ request.form.get('budget', '') }}">
    <input type="hidden" name="extra_notes" value="{{ request.form.get('extra_notes', '') }}">
    <button type="submit" class="pdf-button">Download Detailed PDF Report</button>
  </form>
</div>
{% endif %}

{% if result %}
<div class="result">
  {% if result.error %}
  <div class="error-message">
    <h3>Error</h3>
    <p>{{ result.error }}</p>
  </div>
  {% else %}
  <h3>Business Feasibility Analysis</h3>
  {% endif %}

  <p><strong>Feasibility:</strong> {{ result.feasibility }}%</p>
  <div class="bar-container">
    <div class="bar {{ result.competition }}" style="width: {{ result.feasibility }}%;"></div>
  </div>

  <p><strong>Competition Level:</strong> {{ result.competition }}</p>

  <h4>Advantages</h4>
  <ul class="pros">
    {% for pro in result.pros %}
      <li>{{ pro }}</li>
    {% endfor %}
  </ul>

  <h4>Challenges</h4>
  <ul class="cons">
    {% for con in result.cons %}
      <li>{{ con }}</li>
    {% endfor %}
  </ul>

  <h4>Market Analysis</h4>
  <ul class="market-insights">
    {% for insight in result.market_insights %}
      <li>{{ insight }}</li>
    {% endfor %}
  </ul>

  <h4>Financial Assessment</h4>
  <ul class="budget-analysis">
    {% for analysis in result.budget_analysis %}
      <li>{{ analysis }}</li>
    {% endfor %}
  </ul>

  <h4>Strategic Recommendations</h4>
  <ul class="recommendations">
    {% for rec in result.recommendations %}
      <li>{{ rec }}</li>
    {% endfor %}
  </ul>

  <h4>Recommended Business Types</h4>
  <ul class="recommended-businesses">
    {% for business_type in result.recommended_businesses %}
      <li>{{ business_type }}</li>
    {% endfor %}
  </ul>

  <h4>Nearby Competitors:</h4>
  <div class="competitors-table">
    <table>
      <thead>
        <tr>
          <th>Business Name</th>
          <th>Location</th>
          <th>Rating</th>
          <th>Price Level</th>
        </tr>
      </thead>
      <tbody>
        {% for business in result.businesses %}
                  <tr>
                    <td>{{ business.name }}</td>
                    <td>{{ business.vicinity if business.vicinity else business.location }}</td>
                    <td>{{ business.rating if business.rating else 'N/A' }}</td>
                    <td>{{ business.price_level if business.price_level else 'N/A' }}</td>
                  </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if not result.error %}
  <h4>Map of Nearby Businesses:</h4>
  <div id="map"></div>

  <script>
  var map = L.map('map').setView([{{ result.user_location[0] }}, {{ result.user_location[1] }}], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: 'Â© OpenStreetMap' }).addTo(map);

  // User location marker
  L.marker([{{ result.user_location[0] }}, {{ result.user_location[1] }}]).addTo(map)
      .bindPopup("Your selected location").openPopup();

// Nearby businesses markers
{% for biz in result.businesses %}
    L.marker([{{ biz.lat }}, {{ biz.lng }}]).addTo(map)
      .bindPopup("<b>{{ biz.name }}</b><br>Rating: {{ biz.rating if biz.rating else 'N/A' }}<br>Price: {{ biz.price_level if biz.price_level else 'N/A' }}<br>{{ biz.types }}");
{% endfor %}
  </script>
  {% endif %}
</div>
{% endif %}

</body>
</html>
